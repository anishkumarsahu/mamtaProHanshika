{% load staticfiles %}
{% load pwa %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport">
    <title>456DACN</title>
    <link rel="icon" href="{% static 'images/fevicon.png' %}" type="image/x-icon">
    {% progressive_web_app_meta %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.12/dist/css/bootstrap-select.min.css">
</head>
<body>
{% if messages %}
    {% for message in messages %}
        <span class="validate_data" id="name_status">{{ message }}</span>
    {% endfor %}
{% endif %}
<span id="name_status"></span>
<style>
    .validate_data {
        position: fixed;
        float: left;
        background-color: #e91e63;
        width: 100%;
        color: white;
        font-family: monospace;
        font-size: 12px;
        border-radius: 2px;
        top: 0px;
        left: 0px;
        z-index: 10000;
        height: 70px;
        padding: 30px;
        text-align: center;
        -webkit-transition: opacity 3s ease-in-out;
        -moz-transition: opacity 3s ease-in-out;
        -ms-transition: opacity 3s ease-in-out;
        -o-transition: opacity 3s ease-in-out;
    }

    .invoiceStyle {
        padding: 5px;
        margin: 5px;
        cursor: pointer;
    }

    .tabs-left {
        border-bottom: none;
        border-right: 1px solid #ddd;
    }

    .tabs-left > li {
        float: none;
        margin: 0px;

    }

    .tabs-left > li.active > a,
    .tabs-left > li.active > a:hover,
    .tabs-left > li.active > a:focus {
        border-bottom-color: #ddd;
        border-right-color: transparent;
        background: #f90;
        border: none;
        border-radius: 0px;
        margin: 0px;
    }

    .nav-tabs > li > a:hover {
        line-height: 1.42857143;
        border: 1px solid transparent;
    }

    .tabs-left > li.active > a::after {
        content: "";
        position: absolute;
        top: 10px;
        right: -10px;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;

        border-left: 10px solid #f90;
        display: block;
        width: 0;
    }

    @media screen {
        #printDiv {
            display: none;
        }

        #nonPrintDiv {
            display: block;
        }
    }

    @media print {
        body {
            width: 80mm;
            height: 80mm;
            margin-left: 3mm;
            margin-bottom: 10mm;
            font-size: 14px;
        }

        #nonPrintDiv {
            display: none;
        }

        #printDiv {
            display: block;
        }

    }

    .dropdown-menu > .active > a, .dropdown-menu > .active > a:hover, .dropdown-menu > .active > a:focus {
        color: #fff;
        text-decoration: none;
        background-color: #337ab7;
        outline: 0;
        height: 30px !important;
    }

    .bootstrap-select {
        width: 100% !important;
    }
    .row {
    margin-right: 0;
    margin-left: 0;
}
</style>
<div id="nonPrintDiv">
    <div class="col-md-12">
        <h4>456DACN</h4>
        {% if user == 'Admin' %}
            <ul style="    position: fixed;top: 7px;right: 2%; width: 10%;" class="nav">

                <a href="{% url 'invoiceApp:invoice_report' %}"
                   style="font-weight: bold;width:100%;padding-right: 10px;background-color: #9C27B0;border-color:#9C27B0"
                   type="button" class="btn btn-warning">Admin Panel</a>
            </ul>
        {% else %}
            <ul style="    position: fixed;top: 7px;right: 2%; width: 10%;" class="nav">

                <a href="{% url 'invoiceApp:generate_collection_report' %}"
                   style="font-weight: bold;width:100%;padding-right: 10px;background-color: #9C27B0;border-color:#9C27B0"
                   type="button" class="btn btn-warning">Collection Report</a>
            </ul>
            <ul style="    position: fixed;top: 7px;right: 15%; width: 10%;" class="nav">

                <a href="{% url 'invoiceApp:generate_net_report' %}"
                   style="font-weight: bold;width:100%;padding-right: 10px;background-color: #9C27B0;border-color:#9C27B0"
                   type="button" class="btn btn-warning">Invoice Report</a>
            </ul>
        {% endif %}
        <hr/>
        <div class="col-md-1 col-sm-3 col-xs-12" style="height: 400px;overflow-y: scroll">
            <ul class="nav nav-tabs tabs-left sideways tabClass" style="font-size: 12px;">
                {% for InvoiceSery in InvoiceSeries %}

                    <li id="s{{ InvoiceSery.SeriesID }}" onclick="getInvoiceList('{{ InvoiceSery.SeriesID }}')"><a
                            href="#10"

                            data-toggle="tab"> {{ InvoiceSery.Series }} </a>
                    </li>

                {% endfor %}


            </ul>
            <ul style="    position: fixed;bottom: 80px;font-size: 12px" class="nav">
                <span>user:{% if user == 'Admin' %}
                    Admin
                    {% else %}{{ user.name|capfirst }}
                {% endif %} </span>
            </ul>
            <ul style="position: fixed;bottom: 0;padding-bottom: 20px" class="nav">
                <span style="color: grey;font-size: 12px;position: absolute;top: 37px;left: 0;">{{ user.companyID.name }}</span>
                <a href="{% url 'mamtaApp:logout' %}"
                   style="font-weight: bold;float: left;padding-right: 10px;background-color: #2d4760;border-color: #2d4760"
                   type="button" class="btn btn-warning">Logout</a>
                {% if user != 'Admin' %}
                    <a style="position:absolute;color: #b54f3d;font-size: 13px;cursor: pointer;" data-toggle="modal"
                       data-target="#ChangePasswordModal"
                       data-whatever="@mdo">
                        <stong >Change Password</stong>
                    </a>
                {% endif %}
            </ul>
        </div>

        <div class="col-md-8 col-sm-8 col-xs-12">
            <!-- Tab panes -->
            <div class="tab-content">
                <div class="tab-pane active" id="10">

                    <div class="col-md-12 col-sm-12 col-xs-12"
                         style="padding-bottom: 20px;padding-left: 0;padding-right: 0">


                        <ul id="myTabs" class="nav nav-pills nav-justified" role="tablist" data-tabs="tabs">
                            <li style="background-color: #e6eaff;" onclick="changeTab('cash')" class="active"><a
                                    href="#Commentary" data-toggle="tab">Cash</a>
                            </li>

                            <li style="background-color: #e6eaff;" onclick="changeTab('credit')"><a href="#Videos"
                                                                                                    data-toggle="tab">Credit</a>
                            </li>
                            <li style="background-color: #e6eaff;" onclick="changeTab('collection')"><a
                                    href="#Collection"
                                    data-toggle="tab">Collection</a>
                            </li>
                            <li style="background-color: #e6eaff;" onclick="changeTab('cc')"><a
                                    href="#CashCollection"
                                    data-toggle="tab">CC</a>
                            </li>
                            <li style="background-color: #e6eaff;" onclick="changeTab('return')"><a
                                    href="#Return"
                                    data-toggle="tab">Return</a>
                            </li>
                            <li style="background-color: #e6eaff;" onclick="changeTab('commission')"><a
                                    href="#Commission"
                                    data-toggle="tab">Commission</a>
                            </li>
                            <li style="background-color: #e6eaff;" onclick="changeTab('card')"><a
                                    href="#Card" data-toggle="tab">Card</a>
                            </li>
                            <li style="background-color: #e6eaff;" onclick="changeTab('correction')"><a
                                    href="#Correction" data-toggle="tab">Correction</a>
                            </li>
                            <li style="background-color: #e6eaff;" onclick="changeTab('mix')"><a
                                    href="#Mix" data-toggle="tab">Mix</a>
                            </li>
                            <li style="background-color: #e6eaff;" onclick="changeTab('expense')"><a
                                    href="#Expense" data-toggle="tab">Expense</a>
                            </li>
                              <li style="background-color: #e6eaff;" onclick="changeTab('advance')"><a
                                    href="#Advance" data-toggle="tab">Advance</a>
                            </li>


                        </ul>
                        <div class="tab-content">
                            <form id="SalesForm"> {% csrf_token %}
                                <input type="hidden" id="billType" value="Cash">
                                <div role="tabpanel" class="tab-pane fade in active" id="Commentary">
                                    <div class="row">
                                        <div class="col-sm-6 col-xs-6" id="CashTab">
                                            <div class="form-group"><br>

                                                <div>

                                                    <input readonly type="text" class="form-control" id="billNumber"
                                                           aria-describedby=""
                                                           placeholder="Enter Invoice No">
                                                </div>

                                                <input type="hidden" id="SeriesID" name="SeriesID">
                                                <input type="hidden" id="MainNumber" name="MainNumber">
                                                <input type="hidden" id="MainSeries" name="MainSeries">

                                            </div>
                                        </div>

                                        <div class="col-sm-6 col-xs-6">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="cash" aria-describedby=""
                                                       placeholder="Rs.">

                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="Mix" style="display: none">
                                    <div class="row">
                                        <div class="col-sm-3 col-xs-3" id="MixTab">
                                            <div class="form-group"><br>

                                                <div>

                                                    <input readonly type="text" class="form-control" id="billNumber"
                                                           aria-describedby=""
                                                           placeholder="Enter Invoice No">
                                                </div>

                                                <input type="hidden" id="SeriesID" name="SeriesID">
                                                <input type="hidden" id="MainNumber" name="MainNumber">
                                                <input type="hidden" id="MainSeries" name="MainSeries">

                                            </div>
                                        </div>

                                        <div class="col-sm-3 col-xs-3">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="mixCash"
                                                       aria-describedby=""
                                                       placeholder="Cash Amount(Rs.)">

                                            </div>
                                        </div>
                                        <div class="col-sm-3 col-xs-3">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="mixCard"
                                                       aria-describedby=""
                                                       placeholder="Card Amount(Rs.)">

                                            </div>
                                        </div>

                                        <div class="col-sm-3 col-xs-3">
                                            <div class="form-group"><br>
                                                <input type="text" class="form-control" id="cardRemark"
                                                       aria-describedby=""
                                                       placeholder="Card Remark">

                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div role="tabpanel" class="tab-pane fade" id="Card" style="display:none;">
                                    <div class="row">
                                        <div class="col-sm-4 col-xs-4" id="CardTab">
                                            <div class="form-group"><br>

                                                <div>

                                                    <input readonly type="text" class="form-control" id="billNumber"
                                                           aria-describedby=""
                                                           placeholder="Enter Invoice No">
                                                </div>

                                                <input type="hidden" id="SeriesID" name="SeriesID">
                                                <input type="hidden" id="MainNumber" name="MainNumber">
                                                <input type="hidden" id="MainSeries" name="MainSeries">

                                            </div>
                                        </div>

                                        <div class="col-sm-4 col-xs-4">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="cardd" aria-describedby=""
                                                       placeholder="Rs.">

                                            </div>
                                        </div>
                                        <div class="col-sm-4 col-xs-4">
                                            <div class="form-group"><br>
                                                <input type="text" class="form-control" id="cardRemarkOri"
                                                       aria-describedby=""
                                                       placeholder="Remark">

                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="Videos" style="display:none;">
                                    <div class="row">
                                        <div class="col-sm-2 col-xs-2" id="CreditTab">

                                        </div>
                                        <div class="col-sm-4 col-xs-4">

                                            <div class="form-group"><br><select id="name"
                                                                                class="selectpicker loadBuyer form-control"
                                                                                data-show-subtext="true"
                                                                                data-live-search="true"></select></div>
                                        </div>
                                        <div class="col-sm-3 col-xs-3">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="credit"
                                                       aria-describedby=""
                                                       placeholder="Amount (Rs.)">

                                            </div>
                                        </div>
                                        <div class="col-sm-3 col-xs-3">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="challanNumber"
                                                       aria-describedby=""
                                                       placeholder="Challan Number">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="Collection" style="display:none;">
                                    <div class="row" id="collection1">
                                        <div class="col-sm-4 col-xs-4">
                                            <div class="form-group"><br><select id="partyName1"
                                                                                class="selectpicker loadBuyer form-control"
                                                                                data-show-subtext="true"
                                                                                data-live-search="true"></select></div>
                                        </div>
                                        <div class="col-sm-4 col-xs-4">
                                            <div class="form-group"><br><input type="number" class="form-control"
                                                                               id="partyAmount1" aria-describedby=""
                                                                               placeholder="Rs." value="0"></div>
                                        </div>
                                        <div class="col-sm-4 col-xs-4">
                                            <div class="form-group"><br><input type="text" class="form-control"
                                                                               id="collectionremark" aria-describedby=""
                                                                               placeholder="Remark"></div>
                                        </div>

                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="CashCollection" style="display:none;">
                                    <div class="row">

                                        <div class="row" id="collection2">
                                            <div class="col-sm-6 col-xs-6">
                                                <div class="form-group"><br><select id="partyName"
                                                                                    class="selectpicker loadBuyer form-control"
                                                                                    data-show-subtext="true"
                                                                                    data-live-search="true"></select>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-xs-6">
                                                <div class="form-group"><br><input type="number" class="form-control"
                                                                                   id="partyAmount" aria-describedby=""
                                                                                   placeholder="Rs." value="0"></div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="Return" style="display:none;">
                                    <div class="row">
                                        <div class="col-sm-3">

                                            <div class="form-group"><br>
                                                <select class="form-control" id="sIDReturn"
                                                        style="padding: 2px!important;cursor: pointer">

                                                    {% for InvoiceSery in InvoiceSeries %}
                                                        <option value="{{ InvoiceSery.Series }}">{{ InvoiceSery.Series }}</option>
                                                    {% endfor %}


                                                </select>
                                            </div>

                                        </div>
                                        <div class="col-sm-5">

                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="invoiceNumberReturn"
                                                       aria-describedby=""
                                                       placeholder="Invoice Number">
                                            </div>

                                        </div>
                                        <div class="col-sm-4 col-xs-4">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="AmountReturn"
                                                       aria-describedby=""
                                                       placeholder="Rs." value="0">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="Correction" style="display:none;">
                                    <div class="row">
                                        <div class="col-sm-3">

                                            <div class="form-group"><br>
                                                <select class="form-control" id="sIDCorrection"
                                                        style="padding: 2px!important;cursor: pointer">

                                                    {% for InvoiceSery in InvoiceSeries %}
                                                        <option value="{{ InvoiceSery.Series }}">{{ InvoiceSery.Series }}</option>
                                                    {% endfor %}


                                                </select>
                                            </div>

                                        </div>
                                        <div class="col-sm-5">

                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="invoiceNumberCorrection"
                                                       aria-describedby=""
                                                       placeholder="Invoice Number">
                                            </div>

                                        </div>
                                        <div class="col-sm-4 col-xs-4">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="AmountCorrection"
                                                       aria-describedby=""
                                                       placeholder="Rs." value="0">

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div role="tabpanel" class="tab-pane fade" id="Commission" style="display:none;">
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <div class="form-group"><br>
                                                <select class="form-control" id="sIDCommission"
                                                        style="padding: 2px!important;cursor: pointer">

                                                    {% for InvoiceSery in InvoiceSeries %}
                                                        <option value="{{ InvoiceSery.Series }}">{{ InvoiceSery.Series }}</option>
                                                    {% endfor %}


                                                </select>
                                            </div>

                                        </div>
                                        <div class="col-sm-5">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="invoiceNumberCommission"
                                                       aria-describedby=""
                                                       placeholder="Invoice Number">
                                            </div>

                                        </div>
                                        <div class="col-sm-4 col-xs-4">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="AmountCommission"
                                                       aria-describedby=""
                                                       placeholder="Rs." value="0">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="Expense" style="display:none;">
                                    <div class="row">

                                        <div class="col-sm-6">
                                            <div class="form-group"><br>
                                                <input type="text" class="form-control" id="exRemark"
                                                       aria-describedby=""
                                                       placeholder="Expense Remark">
                                            </div>

                                        </div>
                                        <div class="col-sm-6 col-xs-6">
                                            <div class="form-group"><br>
                                                <input type="number" class="form-control" id="exAmount"
                                                       aria-describedby=""
                                                       placeholder="(Rs.) Amount" value="0">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                             <div role="tabpanel" class="tab-pane fade" id="Advance" style="display:none;">
                                    <div class="row">

                                        <div class="row" id="collection2">
                                            <div class="col-sm-6 col-xs-6">
                                                <div class="form-group"><br><select id="partyNameAdvance"
                                                                                    class="selectpicker loadBuyer form-control"
                                                                                    data-show-subtext="true"
                                                                                    data-live-search="true"></select>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-xs-6">
                                                <div class="form-group"><br><input type="number" class="form-control"
                                                                                   id="partyAmountAdvance" aria-describedby=""
                                                                                   placeholder="Rs." value="0"></div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div style="text-align: center;">
                                    <button style="padding-right: 30px;padding-left: 30px;display: none;" type="button"
                                            class="btn btn-primary" id="loading">Saving ... Please wait.
                                    </button>
                                    <button style="padding-right: 30px;padding-left: 30px" type="button"
                                            class="btn btn-primary" onclick="postSales()" id="save">Save
                                    </button>
                                    <button style="padding-right: 30px;padding-left: 30px" type="button"
                                            class="btn btn-danger" onclick="resetForm()">Reset
                                    </button>
                                    <button id="collectionBtn" type="button"
                                            style="padding-right: 10px;padding-left: 10px;display: none"
                                            class="btn btn-success" data-toggle="modal" data-target="#addPartyModal"
                                            data-whatever="@mdo">Add Party
                                    </button>


                                </div>
                            </form>
                        </div>

                    </div>

                    <div class="col-md-12 col-sm-12 col-xs-12">

                        <div>
                            <div class="col-sm-6">
                                <div style="padding-top: 10px">
                                    <label style="color: #0178fc">Un-Used Bills</label> <br>
                                    <div style="width: 100%;overflow-x: scroll;height: 45px;overflow-y: hidden">
                        <span id="unuse">

                         </span>
                                    </div>
                                </div>
                                <div style="padding-top: 10px">
                                    <label style="color: #0178fc">Used Bills</label> <br>
                                    <div style="width: 100%;overflow-x: scroll;height: 45px;overflow-y: hidden">
                        <span id="used">

                         </span>
                                    </div>
                                </div>
                                <div style="padding-top: 10px">
                                    <label style="color: #0178fc">Today's Collection</label> <br>
                                    <div style="width: 100%;overflow-x: scroll;height: 45px;overflow-y: hidden">
                        <span id="todayCollection">

                         </span>
                                    </div>
                                </div>
                            </div>


                            <div class="col-sm-6">
                                <div style="padding-top: 10px">
                                    <label style="color: #0178fc">Today's CC</label> <br>
                                    <div style="width: 100%;overflow-x: scroll;height: 45px;overflow-y: hidden">
                        <span id="todayCashCollection">

                         </span>
                                    </div>
                                </div>
                                <div style="padding-top: 10px">
                                    <label style="color: #0178fc">Today's Returns</label> <br>
                                    <div style="width: 100%;overflow-x: scroll;height: 45px;overflow-y: hidden">
                        <span id="todayReturn">

                         </span>
                                    </div>
                                </div>
                                <div style="padding-top: 10px">
                                    <label style="color: #0178fc">Today's Commission</label> <br>
                                    <div style="width: 100%;overflow-x: scroll;height: 45px;overflow-y: hidden">
                        <span id="todayCommission">

                         </span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="col-sm-6">
                            <label style="color: #0178fc"> Last Three (3) Recent Invoices</label>
                            <div style="padding-top: 5px;overflow-x: scroll;">

                                <div style="width: 100%;height: 30px;">
                    <span id="recent">

                     </span>
                                </div>
                            </div>

                        </div>
                        <div class="col-sm-6">
                            <label style="color: #0178fc"> Today's Correction</label>
                            <div style="padding-top: 5px;overflow-x: scroll;">

                                <div style="width: 100%;height: 30px;">
                    <span id="todayCorrection">

                     </span>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="col-sm-6">
                             <label style="color: #0178fc"> Today's Staff Advance</label>
                            <div style="padding-top: 5px;overflow-x: scroll;">

                                <div style="width: 100%;height: 30px;">
                    <span id="todayAdvance">

                     </span>
                                </div>
                            </div>


                        </div>
                        <div class="col-sm-6">
                            <label style="color: #0178fc"> Today's Expense</label>
                            <div style="padding-top: 5px;overflow-x: scroll;">

                                <div style="width: 100%;height: 30px;">
                    <span id="todayExpense">

                     </span>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-3 col-xs-12">
            <div class="form-group">

                <div style="padding-top: 35px">
                    <form method="post" id="SearchForm"> {% csrf_token %}

                        <div class="col-sm-4">
                            <label style="color: #0178fc" for="sID">Series</label>
                            <select class="form-control" id="sID"
                                    style="padding: 2px!important;cursor: pointer">

                                {% for InvoiceSery in InvoiceSeries %}
                                    <option value="{{ InvoiceSery.SeriesID }}">{{ InvoiceSery.Series }}</option>
                                {% endfor %}


                            </select>

                        </div>
                        <div class="col-sm-8">
                            <label style="color: #0178fc" for="searchID">Search Invoice</label>
                            <input type="number" class="form-control" id="searchID" aria-describedby=""
                                   placeholder="Search Invoice Number">

                        </div>

                        <div class="col-sm-12" style="text-align: center;margin-top: 15px;">

                            <button style="padding-right: 10px;padding-left: 10px" type="button"
                                    class="btn btn-primary" onclick="searchSales()">Search
                            </button>
                            <button style="padding-right: 10px;padding-left: 10px" type="button"
                                    class="btn btn-danger" onclick="searchReset()">Reset
                            </button>


                        </div>
                    </form>
                </div>
            </div>
            <div style="padding-top: 30px;display: none;" id="resultDiv">
                <label style="color: #0178fc">Search Result of - <strong id="s0"></strong></label> <br>
                <div id="result" style="color: grey">
                    <span>Sales Type: <strong id="s1"></strong></span> <br>
                    <span>Amount: â‚¹  <strong id="s2"></strong></span><br>
                    <span>Customer Name:<strong id="s3"></strong></span><br>
                    <span>Datetime:<strong id="s4"></strong></span><br>
                    <span>Created:<strong id="s5"></strong></span><br>
                    <span>Remark:<strong id="s6"></strong></span><br>
                </div>
            </div>
            <div style="padding-top: 30px;display: none;" id="noresultDiv">
                <p>Result not Found.</p>
                <span id="useNow"></span>
            </div>

            <div id="demo" class="collapse" style="padding-top: 10px;">
                <span style="color: grey;font-weight: bold;margin-bottom: 10px;margin-top: 10px;">Skipped Invoice</span>
                <div style="height: 250px;overflow-y: scroll;overflow-x: hidden;">
                    <div class="row">
                        <div class="col-xs-12" id="skipped">

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="clearfix"></div>
    <a data-toggle="modal" data-target="#addClosingBalance"
       style="font-weight: bold;padding-right: 10px;background-color: #e9542c;border-color: #e9542c;right: 15%;bottom: 2%;position: fixed"
       type="button" class="btn btn-warning">Closing Balance</a>
    <a data-toggle="collapse" data-target="#demo" onclick="skippedInvoiceDetails()"
       style="font-weight: bold;padding-right: 10px;background-color: #E91E63;border-color: #E91E63;right: 2%;bottom: 2%;position: fixed"
       type="button" class="btn btn-warning">Skipped Invoice</a>
</div>
<div class="modal fade" id="addPartyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="exampleModalLabel">Add New Party</h4>
            </div>
            <form id="PartyForm"> {% csrf_token %}
                <div class="modal-body">

                    <div class="form-group">
                        <label for="pName" class="control-label">Name:</label>
                        <input autocomplete="off" type="text" class="form-control" id="pName">
                    </div>
                    <div class="form-group">
                        <label for="pPhone" class="control-label">Phone Number:</label>
                        <input autocomplete="off" type="number" class="form-control" id="pPhone">
                    </div>
                    <div class="form-group">
                        <label for="pAddress" class="control-label">Address:</label>
                        <textarea autocomplete="off" class="form-control" id="pAddress"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addParty()">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="ChangePasswordModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="exampleModalLabel">Change Password</h4>
            </div>
            <form id="PasswordForm"> {% csrf_token %}
                <div class="modal-body">

                    <div class="form-group">
                        <label for="nPass" class="control-label">New Password: <span
                                style="color: grey;font-size: 10px;"> Note - Password should be at least 5 character long.</span></label>
                        <input autocomplete="off" type="password" class="form-control" id="nPass">
                    </div>
                    <div class="form-group">
                        <label for="rPass" class="control-label">Confirm New Password:</label>
                        <input autocomplete="off" type="password" class="form-control" id="rPass">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="ChangePassword()">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="addClosingBalance" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="exampleModalLabel">Add Closing Balance</h4>
            </div>
            <form id="ClosingForm"> {% csrf_token %}
                <div class="modal-body">

                    <div class="form-group">
                        <label for="Balance" class="control-label">Closing Balance:</label>
                        <input autocomplete="off" type="number" class="form-control" id="Balance">
                    </div>

                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addClosing()">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>


</div>
<div id="printDiv" style="width: 80mm;height: 80mm;padding: 2mm;font-size: 14px;margin-bottom: 10mm">
    <style>
        .wavy {
            text-decoration-line: underline;
            text-decoration-style: dashed;
            text-decoration-color: grey;

        }

        ul {
            list-style-type: none;
            padding-left: 0px;
        }

        ul li span {
            float: left;
            width: 27mm;
            font-size: 13px;
        }

        .val {
            float: left;
            width: 40mm;
            font-size: 13px;
        }
    </style>
    <p><span class="wavy"
             style="font-size: 17px;width: 100% ;text-align: center;text-transform: uppercase;">{{ user.companyID.name }}</span><br>

    <p style="font-size: 15px"> Created By: <span id="p1">N/A</span></p>
    <p style="font-size: 15px"> Amount (&#8377): <span id="p2">N/A</span></p>
    <p style="font-size: 15px"> Bill No.: <span id="p3">N/A</span></p>
    <p style="font-size: 15px"> Mode: <span id="p5">N/A</span></p>
    <p style="font-size: 15px"> Datetime: <span id="p4">N/A</span></p>

    </p>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.12/dist/js/bootstrap-select.min.js"></script>

<script>
    var id = 'None';
    function getInvoiceList(nid) {
        getInvoiceDetails(nid);
        return id = nid
    }
    $('#name_status').fadeIn().fadeOut(2000);
    $(getInvoiceDetails(id));

    function getInvoiceDetails(id) {
        $('#unuse').html('');
        $('#used').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:get_invoice_series' %}?id=" + id,
            success: function (response) {
                for (i in response.data.Used) {
                    Used = '<span class="label label-success invoiceStyle" ><strong>' + response.data.Used[i].Serial + ' </strong></span>'

                    $('#used').append(Used)
                }

                for (i in response.data.UnUsed) {
                    unuse = '<span class="label label-danger invoiceStyle" onclick="inputData(\'' + response.data.UnUsed[i].Serial + '\',' + response.data.UnUsed[i].SeriesID + ',' + response.data.UnUsed[i].MainNumber + ',\'' + response.data.UnUsed[i].MainSeries + '\')"><strong>' + response.data.UnUsed[i].Serial + ' </strong></span>'

                    $('#unuse').append(unuse)
                }

            },
            error: function () {
                errMsg();
            }
        });

    }
    function inputData(Serial, SeriesID, MainNumber, MainSeries) {
        $('#billNumber').val(Serial);
        $('#SeriesID').val(SeriesID);
        $('#MainNumber').val(MainNumber);
        $('#MainSeries').val(MainSeries);
    }
    function changeTab(t) {
        var bill = '<div class="form-group"><br><div><input readonly type="text" class="form-control" id="billNumber"aria-describedby=""placeholder="Enter Invoice No"></div><input type="hidden" id="SeriesID" name="SeriesID"><input type="hidden" id="MainNumber" name="MainNumber"><input type="hidden" id="MainSeries" name="MainSeries"></div>'
        if (t === 'cash') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', '');
            $('#Videos').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#Return').css('display', 'none');
            $('#Commission').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#billType').val('Cash');
            $('#collectionBtn').css('display', 'none');
            $('#CashTab').html(bill);
            $('#CreditTab').html('');
            $('#CardTab').html('');
            $('#MixTab').html('');
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', 'none');
             $('#Advance').css('display', 'none');
        }
        if (t === 'credit') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#Videos').css('display', '');
            $('#Return').css('display', 'none');
            $('#Commission').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#billType').val('Credit');
            $('#collectionBtn').css('display', '');
            $('#CashTab').html('');
            $('#CreditTab').html(bill);
            $('#CardTab').html('');
            $('#MixTab').html('');
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', 'none');
             $('#Advance').css('display', 'none');
        }
        if (t === 'card') {
            $('#Card').css('display', '');
            $('#Commentary').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#Videos').css('display', 'none');
            $('#Return').css('display', 'none');
            $('#Commission').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#billType').val('Card');
            $('#collectionBtn').css('display', 'none');
            $('#CashTab').html('');
            $('#CreditTab').html('');
            $('#CardTab').html(bill);
            $('#MixTab').html('');
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', 'none');
             $('#Advance').css('display', 'none');
        }
        if (t === 'collection') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', 'none');
            $('#Videos').css('display', 'none');
            $('#Collection').css('display', '');
            $('#Return').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#Commission').css('display', 'none');
            $('#billType').val('Collection');
            $('#collectionBtn').css('display', '');
            getCollectionDetails();
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', 'none');
             $('#Advance').css('display', 'none');
        }
        if (t === 'cc') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', 'none');
            $('#Videos').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#CashCollection').css('display', '');
            $('#Return').css('display', 'none');
            $('#Commission').css('display', 'none');
            $('#billType').val('cc');
            $('#collectionBtn').css('display', '');
            getCashCollectionDetails();
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', 'none');
             $('#Advance').css('display', 'none');
        }
        if (t === 'return') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', 'none');
            $('#Videos').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#Return').css('display', '');
            $('#Commission').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#billType').val('Return');
            $('#collectionBtn').css('display', 'none');
            getReturnDetails();
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', 'none');
             $('#Advance').css('display', 'none');
        }
        if (t === 'commission') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', 'none');
            $('#Videos').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#Return').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#Commission').css('display', '');
            $('#billType').val('Commission');
            $('#collectionBtn').css('display', 'none');
            getCommissionDetails();
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', 'none');
             $('#Advance').css('display', 'none');
        }
        if (t === 'correction') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', 'none');
            $('#Videos').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#Return').css('display', 'none');
            $('#Commission').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#billType').val('Correction');
            $('#collectionBtn').css('display', 'none');
            getCorrectionDetails();
            $('#Correction').css('display', '');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', 'none');
             $('#Advance').css('display', 'none');
        }
        if (t === 'mix') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#Videos').css('display', 'none');
            $('#Return').css('display', 'none');
            $('#Commission').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#billType').val('Mix');
            $('#collectionBtn').css('display', 'none');
            $('#CashTab').html('');
            $('#CreditTab').html('');
            $('#CardTab').html('');
            $('#MixTab').html(bill);
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', '');
            $('#Expense').css('display', 'none');
             $('#Advance').css('display', 'none');
        }
        if (t === 'expense') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', 'none');
            $('#Videos').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#Return').css('display', 'none');
            $('#Commission').css('display', 'none');
            $('#billType').val('expense');
            $('#collectionBtn').css('display', 'none');
            getExpenseDetails();
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', '');
            $('#Advance').css('display', 'none');
        }

          if (t === 'advance') {
            $('#Card').css('display', 'none');
            $('#Commentary').css('display', 'none');
            $('#Videos').css('display', 'none');
            $('#Collection').css('display', 'none');
            $('#CashCollection').css('display', 'none');
            $('#Return').css('display', 'none');
            $('#Commission').css('display', 'none');
            $('#billType').val('advance');
            $('#collectionBtn').css('display', '');
            getStaffAdvanceDetails();
            $('#Correction').css('display', 'none');
            $('#Mix').css('display', 'none');
            $('#Expense').css('display', 'none');
            $('#Advance').css('display', '');
        }
    }

    $('#SalesForm').keypress(function (e) {
        if (e.which == 13) {
            postSales();
        }
    });

    function postSales() {
        var billType = $('#billType').val();
        var csrfmiddlewaretoken = $("input[name='csrfmiddlewaretoken']").val();
        if (billType !== 'expense') {

            var SeriesID = $('#SeriesID').val();
            var MainNumber = $('#MainNumber').val();
            var MainSeries = $('#MainSeries').val();
            var billNumber = $('#billNumber').val();

            if (billType === 'Cash') {

                var amount = $('#cash').val();
                var ChallanNumber = 'N/A';
                data = new FormData();
                data.append('SalesType', billType);
                data.append('BillNumber', billNumber);
                data.append('CustomerName', 'N/A');
                data.append('Amount', amount);
                data.append('CardAmount', '0');
                data.append('SeriesID', SeriesID);
                data.append('MainNumber', MainNumber);
                data.append('MainSeries', MainSeries);
                data.append('ChallanNumber', ChallanNumber);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                if (billNumber === "" || amount === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {

                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:create_invoice' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,


                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Invoice Created.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();
                                $(getInvoiceDetails(id));
                                getRecentThreeInvoices();
                                $('#billNumber').val('');
                                $('.collapse').collapse('hide');
                                $('#p1').html(response.data['createdBy']);
                                $('#p2').html(response.data['amount']);
                                $('#p3').html(response.data['billNo']);
                                $('#p4').html(response.data['datetime']);
                                $('#p5').html(response.data['ModeOfPayment']);
                                window.print();
                            }
                            else {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html(response.message).fadeIn().fadeOut(2000);

                            }

                            $('#SearchForm')[0].reset();
                            $('#save').attr('disabled', false);

                        },
                        error: function () {
                            errMsg();
                        }
                    });

                }
            }
            if (billType === 'Card') {

                var amount = $('#cardd').val();
                var remark = $('#cardRemarkOri').val();
                var ChallanNumber = 'N/A';
                data = new FormData();
                data.append('SalesType', billType);
                data.append('BillNumber', billNumber);
                data.append('CustomerName', 'N/A');
                data.append('Amount', amount);
                data.append('Remark', remark);
                data.append('CardAmount', '0');
                data.append('SeriesID', SeriesID);
                data.append('MainNumber', MainNumber);
                data.append('MainSeries', MainSeries);
                data.append('ChallanNumber', ChallanNumber);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                if (billNumber === "" || amount === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {

                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:create_invoice' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,


                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Invoice Created.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();
                                $(getInvoiceDetails(id));
                                getRecentThreeInvoices();
                                $('#billNumber').val('');
                                $('.collapse').collapse('hide');
                                $('#p1').html(response.data['createdBy']);
                                $('#p2').html(response.data['amount']);
                                $('#p3').html(response.data['billNo']);
                                $('#p4').html(response.data['datetime']);
                                $('#p5').html(response.data['ModeOfPayment']);
                                window.print();
                            }
                            else {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html(response.message).fadeIn().fadeOut(2000);

                            }

                            $('#SearchForm')[0].reset();
                            $('#save').attr('disabled', false);

                        },
                        error: function () {
                            errMsg();
                        }
                    });

                }
            }

            if (billType === 'Mix') {

                var cashAmount = $('#mixCash').val();
                var cardAmount = $('#mixCard').val();
                var cardRemark = $('#cardRemark').val();
                var ChallanNumber = 'N/A';
                data = new FormData();
                data.append('SalesType', billType);
                data.append('BillNumber', billNumber);
                data.append('CustomerName', 'N/A');
                data.append('Amount', cashAmount);
                data.append('CardAmount', cardAmount);
                data.append('SeriesID', SeriesID);
                data.append('MainNumber', MainNumber);
                data.append('MainSeries', MainSeries);
                data.append('ChallanNumber', ChallanNumber);
                data.append('cardRemark', cardRemark);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                if (billNumber === "" || cashAmount === "" || cardAmount === ""|| cardRemark === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {

                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:create_invoice' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,
                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Invoice Created.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();
                                $(getInvoiceDetails(id));
                                getRecentThreeInvoices();
                                $('#billNumber').val('');
                                $('.collapse').collapse('hide');
                                $('#p1').html(response.data['createdBy']);
                                $('#p2').html(response.data['amount']);
                                $('#p3').html(response.data['billNo']);
                                $('#p4').html(response.data['datetime']);
                                $('#p5').html(response.data['ModeOfPayment']);
                                window.print();
                            }
                            else {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html(response.message).fadeIn().fadeOut(2000);

                            }
                            $('#SearchForm')[0].reset();
                            $('#save').attr('disabled', false);

                        },
                        error: function () {
                            errMsg();
                        }
                    });

                }
            }
            if (billType === 'Credit') {
                var amountCredit = $('#credit').val();
                var name = $('#name').val();
                var ChallanNumber = $('#challanNumber').val();
                data = new FormData();
                data.append('SalesType', billType);
                data.append('BillNumber', billNumber);
                data.append('CustomerName', name);
                data.append('Amount', amountCredit);
                data.append('CardAmount', '0');
                data.append('SeriesID', SeriesID);
                data.append('MainNumber', MainNumber);
                data.append('MainSeries', MainSeries);
                data.append('ChallanNumber', ChallanNumber);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);
                if (billNumber === "" || amountCredit === "" || name === "" || ChallanNumber === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);
                }
                else {
                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:create_invoice' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,


                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Invoice Created.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();
                                $(getInvoiceDetails(id));
                                getRecentThreeInvoices();
                                $('#billNumber').val('');
                                $('.collapse').collapse('hide')
                            }
                            else {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html(response.message).fadeIn().fadeOut(2000);

                            }

                            $('#SearchForm')[0].reset();
                            $('#save').attr('disabled', false);
                        },
                        error: function () {
                            errMsg();
                        }
                    });

                }
            }

            if (billType === 'Collection') {
                var partyName = $('#partyName1').val();
                var partyAmount = $('#partyAmount1').val();
                var collectionremark = $('#collectionremark').val();
                data = new FormData();
                data.append('partyName', partyName);
                data.append('partyAmount', partyAmount);
                data.append('collectionremark', collectionremark);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                if (partyName === "" || partyAmount === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {
                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:take_collection' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,


                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Collection Created.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();


                            }

                            $('#SearchForm')[0].reset();
                            getCollectionDetails();
                            $('#save').attr('disabled', false);
                        },
                        error: function () {
                            errMsg();
                        }
                    });

                }
            }
            if (billType === 'cc') {
                var partyName = $('#partyName').val();
                var partyAmount = $('#partyAmount').val();
                data = new FormData();
                data.append('partyName', partyName);
                data.append('partyAmount', partyAmount);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);


                if (partyName === null || partyAmount === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {
                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:take_cash_collection' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,


                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New CC Created.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();


                            }

                            $('#SearchForm')[0].reset();
                            getCashCollectionDetails();
                            $('#save').attr('disabled', false);
                        },
                        error: function () {
                            errMsg();
                        }
                    });

                }
            }
            if (billType === 'advance') {
                var partyName = $('#partyNameAdvance').val();
                var partyAmount = $('#partyAmountAdvance').val();
                data = new FormData();
                data.append('partyName', partyName);
                data.append('partyAmount', partyAmount);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                if (partyName === null || partyAmount === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {
                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:staff_advance_post' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,


                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Staff Advance Created.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();



                            }

                            $('#SearchForm')[0].reset();
                            getStaffAdvanceDetails();
                            $('#save').attr('disabled', false);
                        },
                        error: function () {
                            errMsg();

                        }
                    });

                }
            }

            if (billType === 'Return') {
                var sIDReturn = $('#sIDReturn').val();
                var invoiceNumberReturn = $('#invoiceNumberReturn').val();
                var AmountReturn = $('#AmountReturn').val();
                data = new FormData();
                data.append('sIDReturn', sIDReturn);
                data.append('invoiceNumberReturn', invoiceNumberReturn);
                data.append('AmountReturn', AmountReturn);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                if (invoiceNumberReturn === "" || AmountReturn === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {
                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:return_collection' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,
                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Return Added.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();
                            }
                            getReturnDetails();
                            $('#SearchForm')[0].reset();
                            $('#save').attr('disabled', false);
                        },
                        error: function () {
                            errMsg();
                        }


                    });


                }
            }

            if (billType === 'Commission') {
                var sIDReturn = $('#sIDCommission').val();
                var invoiceNumberReturn = $('#invoiceNumberCommission').val();
                var AmountReturn = $('#AmountCommission').val();
                data = new FormData();
                data.append('sIDReturn', sIDReturn);
                data.append('invoiceNumberReturn', invoiceNumberReturn);
                data.append('AmountReturn', AmountReturn);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                if (invoiceNumberReturn === "" || AmountReturn === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {
                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:commission_collection' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,


                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Commission Added.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();
                            }

                            $('#SearchForm')[0].reset();
                            getCommissionDetails();
                            $('#save').attr('disabled', false);
                        },
                        error: function () {
                            errMsg();
                        }
                    });

                }
            }
            if (billType === 'Correction') {
                var sIDReturn = $('#sIDCorrection').val();
                var invoiceNumberReturn = $('#invoiceNumberCorrection').val();
                var AmountReturn = $('#AmountCorrection').val();
                data = new FormData();
                data.append('sIDReturn', sIDReturn);
                data.append('invoiceNumberReturn', invoiceNumberReturn);
                data.append('AmountReturn', AmountReturn);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                if (invoiceNumberReturn === "" || AmountReturn === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {
                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:correct_collection' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,


                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Correction Added.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();
                                $('#p1').html(response.data['createdBy']);
                                $('#p2').html(response.data['amount']);
                                $('#p3').html(response.data['billNo']);
                                $('#p4').html(response.data['datetime']);
                                $('#p5').html(response.data['ModeOfPayment']);
                                window.print();


                            }
                            getCorrectionDetails();
                            $('#SearchForm')[0].reset();
                            $('#save').attr('disabled', false);
                        },
                        error: function () {
                            errMsg();
                        }
                    });
                }
            }
        }

        else {
            if (billType === 'expense') {
                var exRemark = $('#exRemark').val();
                var exAmount = $('#exAmount').val();
                data = new FormData();
                data.append('exRemark', exRemark);
                data.append('exAmount', exAmount);
                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                if (exRemark === "" || exAmount === "") {
                    $('#name_status').addClass('validate_data');
                    $('#name_status').html('* fields are required.').fadeIn().fadeOut(2000);

                }
                else {
                    $('#save').attr('disabled', true);
                    $.ajax({
                        type: 'post',
                        url: '{% url 'invoiceApp:add_expense' %}',
                        data: data,
                        contentType: false,
                        cache: false,
                        processData: false,
                        success: function (response) {
                            if (response.message === 'success') {
                                $('#name_status').addClass('validate_data');
                                $('#name_status').html('New Expense Added.').fadeIn().fadeOut(2000);
                                $('#SalesForm')[0].reset();
                            }
                            getExpenseDetails();
                            $('#SearchForm')[0].reset();
                            $('#save').attr('disabled', false);
                        },
                        error: function () {
                            errMsg();
                        }


                    });


                }
            }
        }
        $("#partyName1").val('');
        $("#partyName1").selectpicker("refresh");
        $("#partyName").val('');
        $("#partyName").selectpicker("refresh");
        $("#name").val('');
        $("#name").selectpicker("refresh");
        $("#partyNameAdvance").val('');
        $("#partyNameAdvance").selectpicker("refresh");


    }
    function resetForm() {

        $('#SalesForm')[0].reset();
        $('#billNumber').val('');
        $("#partyName1").val('');
        $("#partyName1").selectpicker("refresh");
        $("#partyName").val('');
        $("#partyName").selectpicker("refresh");
        $("#name").val('');
        $("#name").selectpicker("refresh");
        $("#partyNameAdvance").val('');
        $("#partyNameAdvance").selectpicker("refresh");
    }
    $(".tabClass li:first").addClass("active");

    function searchSales() {

        var sID = $('#sID').val();
        var searchID = $('#searchID').val();
        var csrfmiddlewaretoken = $("input[name='csrfmiddlewaretoken']").val();

        data = new FormData();
        data.append('sID', sID);
        data.append('searchID', searchID);
        data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

        if (searchID === "") {
            $('#name_status').addClass('validate_data');
            $('#name_status').html('Search fields is required.').fadeIn().fadeOut(2000);

        }
        else {
            $.ajax({
                type: 'post',
                url: '{% url 'invoiceApp:search_invoice' %}',
                data: data,
                contentType: false,
                cache: false,
                processData: false,
                success: function (response) {
                    if (response.message === 'success') {
                        $('#resultDiv').css('display', '');
                        $('#noresultDiv').css('display', 'none');
                        $('#s0').html(response.data['BillNumber']);
                        $('#s1').html(response.data['SalesType']);
                        $('#s2').html(response.data['Amount']);
                        $('#s3').html(response.data['CustomerName']);
                        $('#s4').html(response.data['Datetime']);
                        $('#s5').html(response.data['CreatedBy']);
                        $('#s6').html(response.data['Remark']);
                    }
                    else if (response.message === 'notFound') {
                        $('#useNow').html('');
                        $('#name_status').addClass('validate_data');
                        $('#name_status').html('No Invoice Detail Found.').fadeIn().fadeOut(2000);
                        $('#resultDiv').css('display', 'none');
                        $('#noresultDiv').css('display', '');

                        $('#useNow').append('<span class="label label-danger invoiceStyle" onclick="inputData(\'' + response.dataNew.Serial + '\',' + response.dataNew.SeriesID + ',' + response.dataNew.MainNumber + ',\'' + response.dataNew.MainSeries + '\')"><strong> Use Now - ' + response.dataNew.Serial + ' </strong></span>');

                    }
                    else {
                        $('#name_status').addClass('validate_data');
                        $('#name_status').html('Invalid Invoice Number Input').fadeIn().fadeOut(2000);
                        $('#resultDiv').css('display', 'none');
                        $('#noresultDiv').css('display', 'none');
                    }

                    return response;
                },
                error: function () {
                    errMsg();
                }
            });
        }
    }
    function searchReset() {
        $('#SearchForm')[0].reset();
        $('#resultDiv').css('display', 'none');
        $('#noresultDiv').css('display', 'none');
    }
    function checkCustomer(event) {
        var key = event.keyCode;
        return ((key >= 97 && key <= 122) || (key >= 65 && key <= 90) || key == 8 || key == 32);
    }
    function skippedInvoiceDetails() {
        $('#skipped').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:skipped_invoice' %}",
            success: function (response) {
                for (i in response.data.skipped) {
                    skip = '<span class="col-xs-3 label label-warning invoiceStyle" onclick="inputData(\'' + response.data.skipped[i].Serial + '\',' + response.data.skipped[i].SeriesID + ',' + response.data.skipped[i].MainNumber + ',\'' + response.data.skipped[i].MainSeries + '\')"><strong>' + response.data.skipped[i].Serial + ' </strong></span>'

                    $('#skipped').append(skip)
                }
            },
            error: function () {
                errMsg();
            }
        });

    }

    function getCollectionDetails() {
        $('#todayCollection').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:get_today_collection_by_company' %}",
            success: function (response) {
                for (i in response.data) {
                    todayCollection = '<span class="label label-primary invoiceStyle" ><strong>' + response.data[i].Customer + ' - â‚¹ ' + response.data[i].Amount + '  </strong></span>';

                    $('#todayCollection').append(todayCollection)
                }

            },
            error: function () {
                errMsg();
            }
        });

    }
    function getCashCollectionDetails() {
        $('#todayCashCollection').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:get_today_cash_collection_by_company' %}",
            success: function (response) {
                for (i in response.data) {
                    todayCashCollection = '<span class="label label-success invoiceStyle" ><strong>' + response.data[i].Customer + ' - â‚¹ ' + response.data[i].Amount + '  </strong></span>';

                    $('#todayCashCollection').append(todayCashCollection)
                }

            },
            error: function () {
                errMsg();
            }
        });

    }
        function getStaffAdvanceDetails() {
        $('#todayAdvance').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:get_today_staff_advance_by_company' %}",
            success: function (response) {
                for (i in response.data) {
                    todayAdvance = '<span class="label label-info invoiceStyle" ><strong>' + response.data[i].Customer + ' - â‚¹ ' + response.data[i].Amount + '  </strong></span>';

                    $('#todayAdvance').append(todayAdvance)
                }

            },
            error: function () {
                errMsg();
            }
        });

    }
    function addParty() {
        var pName = $('#pName').val();
        var pAddress = $('#pAddress').val();
        var pPhone = $('#pPhone').val();
        if (pAddress === '') {
            pAddress = 'N/A'
        }
        if (pPhone === '') {
            pPhone = 'N/A'
        }
        data = new FormData();
        data.append('pName', pName);
        data.append('pAddress', pAddress);
        data.append('pPhone', pPhone);

        if (pName === "") {
            $('#name_status').addClass('validate_data');
            $('#name_status').html('Party name is required.').fadeIn().fadeOut(2000);

        }
        else {
            $.ajax({
                type: 'post',
                url: '{% url 'invoiceApp:add_party_from_sales' %}',
                data: data,
                contentType: false,
                cache: false,
                processData: false,
                success: function (response) {
                    if (response.message === 'success') {
                        $('#name_status').addClass('validate_data');
                        $('#name_status').html('New Party Added.').fadeIn().fadeOut(2000);
                        $('#PartyForm')[0].reset();
                        $('#addPartyModal').modal('hide');
                        for (i in response.data) {
                            $('#partyName').append('<option  data-subtext="' + response.data[i]["Address"] + '" value="' + response.data[i]["ID"] + '">' + response.data[i]["Name"] + '</option>');
                            $("#partyName").selectpicker('refresh');
                            $('#partyName1').append('<option  data-subtext="' + response.data[i]["Address"] + '" value="' + response.data[i]["ID"] + '">' + response.data[i]["Name"] + '</option>');
                            $("#partyName1").selectpicker('refresh');
                            $('#name').append('<option  data-subtext="' + response.data[i]["Address"] + '" value="' + response.data[i]["Name"] + '">' + response.data[i]["Name"] + '</option>');
                            $("#name").selectpicker('refresh');
                            $('#partyNameAdvance').append('<option  data-subtext="' + response.data[i]["Address"] + '" value="' + response.data[i]["Name"] + '">' + response.data[i]["Name"] + '</option>');
                            $("#partyNameAdvance").selectpicker('refresh');
                        }

                    }

                    else {
                        $('#name_status').addClass('validate_data');
                        $('#name_status').html('Party already exist').fadeIn().fadeOut(2000);
                        $('#SalesForm')[0].reset();
                    }

                },
                error: function () {
                    errMsg();
                }
            });
        }

    }
    function ChangePassword() {
        var nPass = $('#nPass').val();
        var rPass = $('#rPass').val();
        data = new FormData();
        data.append('nPass', nPass);
        if (nPass === "" || rPass === "") {
            $('#name_status').addClass('validate_data');
            $('#name_status').html('Fields are required.').fadeIn().fadeOut(2000);

        }
        else if (nPass != rPass) {
            $('#name_status').addClass('validate_data');
            $('#name_status').html('Password not matched. Please try again.').fadeIn().fadeOut(2000);

        }
        else if (nPass.length < 5) {
            $('#name_status').addClass('validate_data');
            $('#name_status').html('Password should be at least 5 character long.').fadeIn().fadeOut(2000);

        }
        else {
            $.ajax({
                type: 'post',
                url: '{% url 'invoiceApp:change_password_for_sales_user' %}',
                data: data,
                contentType: false,
                cache: false,
                processData: false,
                success: function (response) {
                    if (response.message === 'success') {
                        $('#name_status').addClass('validate_data');
                        $('#name_status').html('Password Changed Successfully').fadeIn().fadeOut(2000);
                        $('#PasswordForm')[0].reset();
                        $('#ChangePasswordModal').modal('hide');

                    }

                    else {
                        errMsg();
                    }

                },
                error: function () {
                    errMsg();
                }
            });
        }
    }
    $(getRecentThreeInvoices());
    function getRecentThreeInvoices() {
        $('#recent').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:get_last_three_invoices' %}",
            success: function (response) {
                for (i in response.data.Used) {
                    recent = '<span class="label label-success invoiceStyle" ><strong>' + response.data.Used[i].Serial + ' </strong></span>'
                    $('#recent').append(recent)
                }
            },
            error: function () {
                errMsg();
            }
        });

    }
    function getReturnDetails() {
        $('#todayReturn').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:get_today_return_by_company' %}",
            success: function (response) {
                for (i in response.data) {
                    todayReturn = '<span class="label label-info invoiceStyle" ><strong>' + response.data[i].InvoiceNumber + ' - â‚¹ ' + response.data[i].Amount + '  </strong></span>';

                    $('#todayReturn').append(todayReturn)
                }

            },
            error: function () {
                errMsg();
            }
        });
    }
    function getCorrectionDetails() {
        $('#todayCorrection').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:get_today_correction_by_company' %}",
            success: function (response) {
                for (i in response.data) {
                    todayCorrection = '<span class="label label-info invoiceStyle" ><strong>' + response.data[i].InvoiceNumber + ' - â‚¹ ' + response.data[i].Amount + '  </strong></span>';

                    $('#todayCorrection').append(todayCorrection)
                }

            },
            error: function () {
                errMsg();
            }
        });
    }
    function getCommissionDetails() {
        $('#todayCommission').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:get_today_commission_by_company' %}",
            success: function (response) {
                for (i in response.data) {
                    todayCommission = '<span class="label label-warning invoiceStyle" ><strong>' + response.data[i].InvoiceNumber + ' - â‚¹ ' + response.data[i].Amount + '  </strong></span>';

                    $('#todayCommission').append(todayCommission)
                }
            },
            error: function () {
                errMsg();
            }
        });
    }
    function getExpenseDetails() {
        $('#todayExpense').html('');
        $.ajax({
            type: 'get',
            url: "{% url 'invoiceApp:get_today_expense_by_company' %}",
            success: function (response) {
                for (i in response.data) {
                    todayExpense = '<span class="label label-warning invoiceStyle" ><strong>' + response.data[i].Remark + ' - â‚¹ ' + response.data[i].Amount + '  </strong></span>';

                    $('#todayExpense').append(todayExpense)
                }
            },
            error: function () {
                errMsg();
            }
        });

    }
    $(document).on("keydown", "input[aria-controls='bs-select-1']", function (e) {
        if ((e.keyCode < 38 || e.keyCode > 40)) {
            if ((e.keyCode !== 13 )) {
                var inputVal = $(this).val();
                $('#name').html('');
                $.ajax({
                    type: 'get',
                    url: "{% url 'invoiceApp:get_buyer_list' %}?q=" + inputVal,
                    success: function (response) {
                        for (i in response.data) {
                            $('#name').append('<option  data-subtext="' + response.data[i]["Address"] + '" value="' + response.data[i]["Name"] + '">' + response.data[i]["Name"] + '</option>');

                        }
                        $("#name").selectpicker('refresh');

                    },
                    error: function () {
                        errMsg();
                    }
                });
            }
        }
    });
    $(document).on("keydown", "input[aria-controls='bs-select-3']", function (e) {

        if ((e.keyCode < 38 || e.keyCode > 40)) {
            if ((e.keyCode !== 13 )) {
                var inputVal = $(this).val();
                $('#partyName').html('');
                $.ajax({
                    type: 'get',
                    url: "{% url 'invoiceApp:get_buyer_list' %}?q=" + inputVal,
                    success: function (response) {

                        $('#partyName').append('<option  value="" selected>Search Party</option>');

                        for (i in response.data) {
                            $('#partyName').append('<option  data-subtext="' + response.data[i]["Address"] + '" value="' + response.data[i]["ID"] + '">' + response.data[i]["Name"] + '</option>');
                        }
                        $("#partyName").selectpicker('refresh');

                    },
                    error: function () {
                        errMsg();
                    }
                });
            }
        }
    });
    $(document).on("keydown", "input[aria-controls='bs-select-2']", function (e) {
        if ((e.keyCode < 38 || e.keyCode > 40)) {
            if ((e.keyCode !== 13 )) {
                var inputVal = $(this).val();
                $('#partyName1').html('');
                $.ajax({
                    type: 'get',
                    url: "{% url 'invoiceApp:get_buyer_list' %}?q=" + inputVal,
                    success: function (response) {
                        $('#partyName1').append('<option  value="" selected>Search Party</option>');
                        for (i in response.data) {
                            $('#partyName1').append('<option  data-subtext="' + response.data[i]["Address"] + '" value="' + response.data[i]["ID"] + '">' + response.data[i]["Name"] + '</option>');
                        }
                        $("#partyName1").selectpicker('refresh');
                    },
                    error: function () {
                        errMsg();
                    }
                });
            }
        }
    });

     $(document).on("keydown", "input[aria-controls='bs-select-4']", function (e) {
        if ((e.keyCode < 38 || e.keyCode > 40)) {
            if ((e.keyCode !== 13 )) {
                var inputVal = $(this).val();
                $('#partyNameAdvance').html('');
                $.ajax({
                    type: 'get',
                    url: "{% url 'invoiceApp:get_buyer_list' %}?q=" + inputVal,
                    success: function (response) {
                        $('#partyNameAdvance').append('<option  value="" selected>Search Party</option>');
                        for (i in response.data) {
                            $('#partyNameAdvance').append('<option  data-subtext="' + response.data[i]["Address"] + '" value="' + response.data[i]["ID"] + '">' + response.data[i]["Name"] + '</option>');
                        }
                        $("#partyNameAdvance").selectpicker('refresh');
                    },
                    error: function () {
                        errMsg();
                    }
                });
            }
        }
    });


    function errMsg() {
        $('#name_status').addClass('validate_data');
        $('#name_status').html('error.').fadeIn().fadeOut(2000);
    }

    function addClosing() {
        var Balance = $('#Balance').val();

        data = new FormData();
        data.append('Balance', Balance);

        if (Balance === "") {
            $('#name_status').addClass('validate_data');
            $('#name_status').html('Please Enter Closing Amount.').fadeIn().fadeOut(2000);

        }
        else {
            $.ajax({
                type: 'post',
                url: '{% url 'invoiceApp:add_closing_balance_api' %}',
                data: data,
                contentType: false,
                cache: false,
                processData: false,
                success: function (response) {
                    if (response.message === 'success') {
                        $('#name_status').addClass('validate_data');
                        $('#name_status').html('Closing Balance Added.').fadeIn().fadeOut(2000);
                        $('#ClosingForm')[0].reset();
                        $('#addClosingBalance').modal('hide');
                    }
                    else {
                        $('#name_status').addClass('validate_data');
                        $('#name_status').html('Closing Balance already added').fadeIn().fadeOut(2000);
                        $('#ClosingForm')[0].reset();
                    }

                },
                error: function () {
                    errMsg();
                }
            });
        }

    }
</script>
</body>
</html>